#!/bin/bash
mkdir -p models

tail -n +2 models.csv | cut -d',' -f2 | while read full; do
    # full = mradermacher/Qwen3-30B-A3B-Thinking-2507-Amoral-Edition-i1-GGUF:Q3_K_L
    repo_id="${full%%:*}"
    quant="${full##*:}"

    reponame="${repo_id##*/}"

    # Derive the expected filename from the repo name
    # e.g., amoral-gemma3-27B-v2-qat-GGUF -> amoral-gemma3-27B-v2-qat
    basename="${reponame%-GGUF}"
    expected_filename="${basename}.${quant}.gguf"

    echo "Processing $repo_id ($quant)"

    # Check if the target file already exists in models/
    if [ -f "models/$expected_filename" ]; then
        echo "SKIP: File already exists â†’ models/$expected_filename"
        continue
    else
        echo "File not found: models/$expected_filename. Proceeding to download."        
    fi

    pattern="*${quant}.gguf"

    echo "Downloading $repo_id (quant: $quant)"

    hf download "$repo_id" \
        --include "$pattern" \
        --local-dir "models"
        
done