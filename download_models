#!/bin/bash
mkdir -p models

tail -n +2 models.csv | cut -d',' -f2 | while read full; do
    # full = mradermacher/Qwen3-30B-A3B-Thinking-2507-Amoral-Edition-i1-GGUF:Q3_K_L
    repo_id="${full%%:*}"
    quant="${full##*:}"

    owner="${repo_id%%/*}"
    reponame="${repo_id##*/}"

    pattern="*${quant}.gguf"

    # Expected final filename:
    # owner_reponame_<originalfile>.gguf
    # But we don't know originalfile yet, so we test presence only after download.

    echo "Processing $repo_id ($quant)"

    # Check if any file for this repo+quant already exists in models/
    found_existing=$(find models -maxdepth 1 -type f -name "${owner}_${reponame}_*${quant}.gguf" | head -n 1)

    if [ -n "$found_existing" ]; then
        echo "SKIP: File already exists â†’ $found_existing"
        continue
    fi

    echo "Downloading $repo_id (quant: $quant)"

    hf download "$repo_id" \
        --include "$pattern" \
        --local-dir "models"
        
done